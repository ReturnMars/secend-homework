# ğŸ” ç”Ÿäº§ç¯å¢ƒåç«¯é•œåƒ (å•äºŒè¿›åˆ¶é›¶ä¾èµ–)
FROM alpine:latest

# 1. å®‰è£…å¿…è¦çš„è¿è¡Œæ—¶ä¾èµ–
# ca-certificates: ç”¨äº HTTPS è¯·æ±‚
# tzdata: ç”¨äºæ­£ç¡®å¤„ç†æ—¶åŒº (Asia/Shanghai)
RUN apk add --no-cache ca-certificates tzdata

WORKDIR /app

# 2. ä»æœ¬åœ°å¤åˆ¶äº¤å‰ç¼–è¯‘å‡ºçš„ Linux äºŒè¿›åˆ¶æ–‡ä»¶
# æ³¨æ„ï¼šæ–‡ä»¶åéœ€ä¸æ‚¨çš„éƒ¨ç½²å·¥å…·æ„å»ºå‡ºçš„æ–‡ä»¶åä¿æŒä¸€è‡´
COPY backend/main-linux /app/server

# 3. å¦‚æœæœ‰é™æ€é…ç½®æˆ–è¿ç§»æ–‡ä»¶éœ€è¦æ‰“åŒ…è¿›é•œåƒï¼Œå¯ä»¥åœ¨è¿™é‡Œæ‰§è¡Œ
COPY backend/migrations /app/migrations

# 4. è¿è¡Œç¯å¢ƒå‡†å¤‡
RUN chmod +x /app/server
# åˆ›å»ºä¸´æ—¶ä¸Šä¼ ç›®å½•
RUN mkdir -p /app/uploads

# 5. ç«¯å£æš´éœ²
EXPOSE 8080

# 6. å¯åŠ¨
CMD ["/app/server"]
