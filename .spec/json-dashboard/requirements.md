# JSON 数据驱动看板生成 - 需求规格

## 1. 概述

### 1.1 背景
用户上传 JSON 数据后，AI 能够自动理解数据结构并生成可视化看板（React 组件）。

### 1.2 核心挑战
- 大 JSON 文件（100KB~1MB）无法直接塞入 LLM 上下文
- 需要让 AI 在有限的 token 内"理解"数据并生成高质量看板

---

## 2. 用户故事

### US-1: 数据上传与自动分析
**作为**用户  
**我希望**上传 JSON 文件后，系统自动分析数据结构  
**以便**后续 AI 能理解我的数据

**验收标准：**
- [x] 支持 JSON/CSV 文件上传（已完成）
- [ ] 上传后自动提取 Schema（字段名、类型、统计信息）
- [ ] Schema 存储到数据库，与 Dataset 关联

### US-2: 对话式看板生成
**作为**用户  
**我希望**通过自然语言描述需求，AI 根据我的数据生成看板  
**以便**快速创建可视化图表

**验收标准：**
- [ ] 对话中自动识别当前 session 关联的 dataset
- [ ] AI 根据 Schema + 采样数据生成 React 看板代码
- [ ] 小数据（< 10KB）：代码内嵌完整数据
- [ ] 大数据（≥ 10KB）：代码通过 fetch(url) 获取数据

### US-3: 数据实时渲染
**作为**用户  
**我希望**生成的看板能显示真实数据  
**以便**验证可视化效果

**验收标准：**
- [ ] 前端 Sandpack 能执行 fetch 请求到后端
- [ ] CORS 正确配置，允许 Sandpack 跨域请求
- [ ] 看板正确渲染真实数据

---

## 3. 功能边界

### 3.1 支持范围
| 项目 | 范围 |
|------|------|
| 文件格式 | JSON, CSV |
| 文件大小 | 最大 500MB（已有限制） |
| 数据写入方式 | < 10KB 内嵌, ≥ 10KB fetch |
| Schema 深度 | Level 3（含统计信息） |

### 3.2 超限处理策略（优先级排序）
1. **拒绝 + 建议**：超过合理范围时，提示用户精简数据
2. **分页/流式**：支持分页获取大数据
3. **统计摘要**：提供数据摘要帮助 AI 理解
4. **字段裁剪**：只保留可视化相关字段
5. **智能采样**：抽取代表性数据行

### 3.3 不在范围内
- 数据清洗/转换（用户需上传干净数据）
- 多数据源关联（单次只处理一个 dataset）
- 实时数据更新（上传后数据静态）

---

## 4. 非功能性需求

### 4.1 性能
- Schema 提取应在 5 秒内完成（100MB 文件）
- 数据 API 响应时间 < 1s

### 4.2 安全
- 数据 API 需验证 session 归属
- 不暴露其他用户的数据

---

## 5. 术语表

| 术语 | 定义 |
|------|------|
| Schema | 数据结构描述，包含字段名、类型、统计信息 |
| Dataset | 用户上传的数据文件及其元数据 |
| 内嵌模式 | AI 生成的代码中硬编码完整数据 |
| Fetch 模式 | AI 生成的代码通过 fetch() 获取外部数据 |

